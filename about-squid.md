# Общая структура

В папке `squid` появились такие основные файлы и папки:

- `src/` — исходный код индексатора (обработка блоков, событий, extrinsics)
- `schema.graphql` — описание структуры данных, которые будут храниться в базе (PostgreSQL)
- `db/` — миграции для базы данных
- `package.json` — зависимости и скрипты
- `squid.yaml` — главный конфиг squid-проекта
- `docker-compose.yml` — запуск инфраструктуры (Postgres, GraphQL сервер и т.д.)
- `README.md` — подробная инструкция по работе с проектом

# Как это работает (data flow)

```
+-------------------+
|                   |
|   Substrate сеть  |
|   (QF TestNet)    |
+-------------------+
          |
          v
+-------------------+
|                   |
|   Индексатор      |
|   (src/,          |
|   @subsquid/      |
|   substrate-      |
|   processor)      |
+-------------------+
          |
          v
+-------------------+
|                   |
|   PostgreSQL      |
|   (db/,           |
|   schema.graphql) |
+-------------------+
          |
          v
+-------------------+
|                   |
|   GraphQL API     |
|   (@subsquid/     |
|   graphql-server) |
+-------------------+
          |
          v
+-------------------+
|                   |
|   Frontend        |
|   (Hasura/        |
|   Next.js)        |
+-------------------+
```

# Описание этапов

1. **Индексатор (`src/`):**
   - Использует пакет `@subsquid/substrate-processor` для подписки на блоки и события Substrate-сети (например, QF TestNet).
   - В обработчиках (handlers) ты описываешь, какие события/экстринзики обрабатывать и как их сохранять в базу.
   - Все данные пишутся в PostgreSQL через TypeORM.

2. **Схема данных (`schema.graphql`):**
   - Описывает, какие сущности и поля будут в базе (например, Block, Transaction, Event, Account).
   - На основе этой схемы автоматически генерируются TypeORM-модели и миграции.

3. **Миграции (`db/`):**
   - После изменения схемы нужно сгенерировать миграции (`sqd migration:generate`) и применить их (`sqd migration:apply`).
   - Это создаёт/обновляет таблицы в базе.

4. **GraphQL сервер:**
   - После запуска индексатора автоматически поднимается GraphQL API (`@subsquid/graphql-server`), который позволяет делать запросы к данным в базе (например, получать последние блоки, транзакции и т.д.).
   - Playground доступен по адресу http://localhost:4350/graphql

5. **Инфраструктура (`docker-compose.yml`):**
   - Можно поднять всю инфраструктуру одной командой (`sqd up`): Postgres, GraphQL сервер, сам индексатор.

# Основные команды

- `npm install` — установка зависимостей
- `sqd up` — запуск Postgres и сервисов
- `sqd build` — сборка TypeScript-кода
- `sqd run .` — запуск индексатора и GraphQL API
- `sqd migration:generate` — генерация миграций после изменения схемы
- `sqd migration:apply` — применение миграций

# Как происходит обработка данных

- Индексатор подписывается на новые блоки и события в Substrate-сети.
- Для каждого блока вызываются твои обработчики (handlers), которые парсят события, экстринзики и сохраняют нужные данные в базу.
- GraphQL сервер автоматически отображает эти данные через API.

# Как это связано с нашим планом

Всё соответствует архитектуре из плана:

QF TestNet → Squid SDK (индексатор) → PostgreSQL → Hasura/GraphQL → Frontend 